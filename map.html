<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Upside Down | You've Been Holding the Map Wrong</title>
  <meta name="description" content="The first photo of Earth had south on top. NASA flipped it. This map flips it back." />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Upside Down | You've Been Holding the Map Wrong" />
  <meta property="og:description" content="The first photo of Earth had south on top. NASA flipped it. This map flips it back." />
  <meta property="og:image" content="/og-image.png" />
  <meta property="og:url" content="https://world-upside-down.vercel.app/map" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Upside Down | You've Been Holding the Map Wrong" />
  <meta name="twitter:description" content="The first photo of Earth had south on top. NASA flipped it. This map flips it back." />
  <meta name="twitter:image" content="/og-image.png" />

  <link href="https://fonts.googleapis.com/css2?family=Anton&family=DM+Sans:wght@400;500;700&family=Instrument+Serif:ital@0;1&family=Space+Mono:ital,wght@0,400;0,700;1,400&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Abril+Fatface&family=Caveat:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/src/style.css" />
</head>
<body>

<!-- SVG filters (hidden) -->
<svg width="0" height="0" style="position:absolute">
  <filter id="riso-rough">
    <feTurbulence type="fractalNoise" baseFrequency="0.04" numOctaves="4" seed="2" result="noise"/>
    <feDisplacementMap in="SourceGraphic" in2="noise" scale="1.5" xChannelSelector="R" yChannelSelector="G"/>
  </filter>
</svg>

<div id="page">

  <!-- ── TOP BAND ── -->
  <div id="top-band">
    <div class="title-group">
      <h1 id="city-title">Upside Down<span class="search-hint" aria-hidden="true">&#x2315;</span></h1>
      <div id="geocoder" class="geocoder">
        <input id="geocoder-input" type="text" placeholder="Search a place..." autocomplete="off" spellcheck="false" />
        <div id="geocoder-results" class="geocoder-results"></div>
      </div>
      <span class="subtitle" id="subtitle"><a href="/story" id="subtitle-link"><span id="subtitle-text">an exercise in unlearning north</span></a><span class="subtitle-cursor" aria-hidden="true"></span></span>
    </div>
    <!-- ── Tool bar (always visible) ── -->
    <div id="toolbar">
      <button class="tb-btn" data-tool="locate" id="tool-locate" aria-label="Find me">&#x2316;</button>
      <button class="tb-btn" data-tool="title" id="tool-title" aria-label="Make it yours">T</button>
      <div class="tb-dropdown" id="ink-dropdown">
        <button class="tb-btn" data-tool="ink" id="tool-ink" aria-label="Ink palette">&#x25C9;</button>
        <div class="tb-dropdown-menu ink-panel" id="ink-panel">
          <div class="ink-presets" id="ink-presets"></div>
          <div class="ink-custom" id="ink-custom"></div>
        </div>
      </div>
      <div class="tb-dropdown" id="font-dropdown">
        <button class="tb-btn" data-tool="font" id="tool-font" aria-label="Font">A</button>
        <div class="tb-dropdown-menu font-panel" id="font-panel">
          <div class="font-pairings" id="font-pairings"></div>
          <div class="font-mix" id="font-mix"></div>
        </div>
      </div>
      <div class="tb-dropdown" id="download-dropdown">
        <button class="tb-btn" data-tool="download" id="tool-download" aria-label="Download">&darr;</button>
        <div class="tb-dropdown-menu" id="download-formats">
          <button class="tb-dropdown-item" data-format="feed">
            <span class="dl-ratio feed-ratio"></span>
            <span>Feed <small>1080&times;1080</small></span>
          </button>
          <button class="tb-dropdown-item" data-format="reel">
            <span class="dl-ratio reel-ratio"></span>
            <span>Story / Reel <small>1080&times;1920</small></span>
          </button>
          <button class="tb-dropdown-item" data-format="poster">
            <span class="dl-ratio poster-ratio"></span>
            <span>Poster <small>3600&times;4800</small></span>
          </button>
        </div>
      </div>
      <div class="tb-dropdown" id="share-dropdown">
        <button class="tb-btn" data-tool="share" id="tool-share" aria-label="Share">&nearr;</button>
        <div class="tb-dropdown-menu" id="share-menu">
          <button class="tb-dropdown-item" data-share="linkedin">LinkedIn</button>
          <button class="tb-dropdown-item" data-share="x">X / Twitter</button>
          <button class="tb-dropdown-item" data-share="copy">Copy link</button>
        </div>
      </div>
      <a href="/story" class="tb-btn" aria-label="The story">?</a>
    </div>

    <div id="coords">
      <span id="coords-lat">51.51° N</span>
      <span class="coord-sep">/</span>
      <span id="coords-lon">0.13° W</span>
      <span class="coord-sep">/</span>
      <span id="coords-zoom">z11.0</span>
    </div>
  </div>

  <!-- ── MAP FRAME ── -->
  <div id="map-frame">
    <div id="map"></div>
    <canvas id="dymaxion-canvas"></canvas>
    <div id="dymaxion-label">No north. No south. Just Earth.</div>

    <!-- ── Trim marks ── -->
    <div class="trim-marks" aria-hidden="true">
      <span class="trim-mark tl"></span>
      <span class="trim-mark tr"></span>
      <span class="trim-mark bl"></span>
      <span class="trim-mark br"></span>
    </div>

    <!-- ── Screenprint title overlay ── -->
    <div id="screenprint-overlay">
      <span class="screenprint-line" id="screenprint-l1">UPSIDE</span>
      <span class="screenprint-line" id="screenprint-l2">DOWN</span>
    </div>

    <!-- ── Flip toast ── -->
    <div id="flip-toast"></div>

    <!-- ── Graticule edge labels (HTML overlay) ── -->
    <div id="grat-edge-labels"></div>

    <!-- ── Map attribution overlay ── -->
    <div id="map-attribution">
      South-up Mercator &middot; 5-colour riso<br>
      Protomaps &middot; OpenStreetMap
    </div>

    <!-- ── Registration mark (decorative) ── -->
    <div class="reg-mark" id="reg-mark" aria-hidden="true">
      <svg width="28" height="28" viewBox="0 0 28 28">
        <circle cx="14" cy="14" r="10" fill="none" stroke="currentColor" stroke-width="0.8"/>
        <line x1="14" y1="2" x2="14" y2="26" stroke="currentColor" stroke-width="0.8"/>
        <line x1="2" y1="14" x2="26" y2="14" stroke="currentColor" stroke-width="0.8"/>
      </svg>
    </div>

    <!-- ── Color strip (title editor) ── -->
    <div class="color-strip" id="color-strip">
      <button class="color-dot active" data-color="#FFE627" data-shadow="#FF48B0" aria-label="Yellow">
        <span style="background:#FFE627"></span>
      </button>
      <button class="color-dot" data-color="#FF48B0" data-shadow="#C4305C" aria-label="Pink">
        <span style="background:#FF48B0"></span>
      </button>
      <button class="color-dot" data-color="#00838A" data-shadow="#004D52" aria-label="Teal">
        <span style="background:#00838A"></span>
      </button>
      <button class="color-dot" data-color="#0078BF" data-shadow="#004A75" aria-label="Blue">
        <span style="background:#0078BF"></span>
      </button>
      <button class="color-dot" data-color="#000000" data-shadow="#333333" aria-label="Black">
        <span style="background:#000000"></span>
      </button>
    </div>

    <!-- ── Export preview ── -->
    <div class="export-preview" id="export-preview">
      <div class="export-canvas" id="export-canvas"></div>
      <div class="export-controls">
        <div class="export-subtitle-row">
          <input type="text" class="export-subtitle" id="export-subtitle"
                 placeholder="Add a subtitle..." maxlength="60" spellcheck="false" />
        </div>
        <div class="export-options-row">
          <div class="color-strip export-color-strip" id="export-color-strip"></div>
          <div class="export-toggles" id="export-toggles">
            <label class="export-toggle"><input type="checkbox" checked data-toggle="compass"> &#x2295;</label>
            <label class="export-toggle"><input type="checkbox" checked data-toggle="coords"> 51&deg;N</label>
            <label class="export-toggle"><input type="checkbox" checked data-toggle="url"> url</label>
          </div>
        </div>
        <div class="export-actions">
          <button class="export-btn export-btn-download" id="export-download">&darr; Download</button>
          <button class="export-btn export-btn-copy" id="export-copy">&#x2398; Copy</button>
        </div>
      </div>
      <button class="export-close" id="export-close" aria-label="Close">&times;</button>
    </div>

    <!-- ── Ticker — scrolling reverse-geocoded phrase ── -->
    <div class="ticker-track" id="ticker-track">
      <span class="ticker" id="ticker"></span>
    </div>

    <!-- ── Touch controls — two flip buttons ── -->
    <div class="touch-controls" id="touch-controls">
      <span class="touch-prompt" id="touch-prompt">Try flipping</span>
      <div class="touch-buttons">
        <button class="flip-btn" data-orient="normal" aria-label="Normal orientation">
          <span class="flip-btn-arrow">&#8593;</span>
          <span class="flip-btn-label">N</span>
        </button>
        <button class="flip-btn" data-orient="mirrored" aria-label="Mirror">
          <span class="flip-btn-arrow">&#8594;</span>
          <span class="flip-btn-label">E</span>
        </button>
      </div>
    </div>
  </div>

  <!-- ── BOTTOM BAND ── -->
  <div id="bot-band">

    <!-- Scale block: north arrow + scale bar + ratio -->
    <div class="scale-block">
      <div class="north-arrow" id="north-arrow">
        <svg width="38" height="38" viewBox="0 0 60 60">
          <line x1="30" y1="0" x2="30" y2="60" stroke="#000000" stroke-width="0.6"/>
          <line x1="0" y1="30" x2="60" y2="30" stroke="#000000" stroke-width="0.6"/>
          <circle cx="30" cy="30" r="24" fill="none" stroke="#000000" stroke-width="1.8"/>
          <circle cx="30" cy="30" r="20" fill="none" stroke="#000000" stroke-width="0.6"/>
          <rect class="north-pointer" x="27" y="30" width="6" height="24" fill="#000000"/>
          <text class="north-label" x="30" y="64" text-anchor="middle" font-family="Space Mono,monospace" font-size="7" font-weight="700" fill="#000000">N</text>
        </svg>
      </div>
      <div class="scale-wrapper">
        <svg id="scale-svg"></svg>
      </div>
      <span class="scale-ratio" id="scale-ratio"></span>
    </div>

    <!-- Legend — 5-Colour Risograph Ink Drums -->
    <div class="legend-block">
      <div class="legend-title">5-Colour Riso &middot; Legend</div>
      <div class="legend-row">
        <div class="leg-item">
          <svg viewBox="0 0 14 14"><rect x="1" y="1" width="12" height="12" rx="1" fill="#88898A" stroke="#6A6B6C" stroke-width="0.8"/></svg>
          <span>Land</span>
        </div>
        <div class="leg-item">
          <svg viewBox="0 0 14 14"><rect x="1" y="1" width="12" height="12" rx="1" fill="#00838A" stroke="#006A70" stroke-width="0.8"/></svg>
          <span>Water</span>
        </div>
        <div class="leg-item">
          <svg viewBox="0 0 14 14"><rect x="1" y="1" width="12" height="12" rx="1" fill="#0078BF" stroke="#005A90" stroke-width="0.8"/></svg>
          <span>Buildings</span>
        </div>
        <div class="leg-item">
          <svg viewBox="0 0 14 14"><rect x="1" y="1" width="12" height="12" rx="1" fill="#FF48B0" stroke="#D03090" stroke-width="0.8"/></svg>
          <span>Parks</span>
        </div>
        <div class="leg-item">
          <svg viewBox="0 0 14 14">
            <line x1="2" y1="7" x2="12" y2="7" stroke="#000000" stroke-width="2"/>
            <line x1="2" y1="10" x2="12" y2="10" stroke="#88898A" stroke-width="1"/>
          </svg>
          <span>Roads</span>
        </div>
        <div class="leg-item">
          <svg viewBox="0 0 14 14">
            <line x1="2" y1="7" x2="12" y2="7" stroke="#000000" stroke-width="1.5" stroke-dasharray="2,1.5"/>
          </svg>
          <span>Boundaries</span>
        </div>
      </div>
    </div>

    <!-- Flip hint (desktop) — in bottom band -->
    <div id="flip-hint">
      <kbd>&uarr;</kbd>
      <span>flip north</span>
      <span class="coord-sep">&middot;</span>
      <kbd>&rarr;</kbd>
      <span>mirror east</span>
    </div>

    <!-- Author credit (maker's mark) -->
    <a href="https://www.linkedin.com/in/gerardoezequielmc/" target="_blank" rel="noopener" class="bot-author">
      <span class="bot-author-name">Gerardo Ezequiel</span>
      <svg width="10" height="10" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
    </a>
  </div>

</div>

<script type="module" src="/src/main.ts"></script>
</body>
</html>
